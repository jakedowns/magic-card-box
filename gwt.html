<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Given When Then</title>
    <!-- Import Vue 3 from CDN -->
    <script src="https://unpkg.com/vue@next"></script>
    <!-- Import Vuex 4 from CDN -->
    <script src="https://unpkg.com/vuex@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- <script src="https://cdn.jsdelivr.net/npm/gherkin/dist/src/index.js" type="module"></script> -->
    <style>
        body,
        html {
            background: #333;
            color: white;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        div {
            color: white;
            font-family: 'Courier New', Courier, monospace;
        }

        h1 {
            font-size: 20px;
            font-weight: bold;
        }

        body,
        html {
            margin: 0;
            padding: 0;
        }
    </style>
    <script type="text/javascript">
        window.state = {
            features: {},
            scenarios: {},
            action_words: []
        }
        class Feature {
            constructor(name) {
                this.name = name
            }
        }
        class Scenario {
            constructor(name) {
                this.name = name
                this.feature_id = null; //getContextFeatureID()
                this.steps = [];
            }
            assignToFeature(feature_id) {
                this.feature_id = null;
            }
            addStep(step) {
                this.steps.push(step)
            }
        }
        class Step {
            constructor(type, name) {
                this.type = type;
                this.name = name;
            }
            assignToScenario(scenarioId) {
                this.scenarioId = scenarioId
            }
        }
        class Parser {
            constructor() {
                // this._parser = new Gherkin.Parser();
            }
            parse(input) {
                // return this._parser.parse(input);
            }
        }
        let parser;
//         document.addEventListener("DOMContentLoaded", () => {
//             parser = new Parser;
//             let doc = parser.parse(`Feature: Example feature
//   Scenario: An example scenario
//     Given I have a configured environment`)
//             console.log({ doc })
//         });
    </script>
    <style>
        @keyframes slideUpAndBack {
            0% {
            transform: translateY(0) translateX(0) scale(1);
            opacity: 1;
            z-index: 100; /* Make sure the card is on top during the animation */
            }
            25% {
            transform: translateY(-100px) translateX(0) scale(1.1);
            opacity: 1;
            }
            75% {
            transform: translateY(-100px) translateX(200px) scale(1.1);
            opacity: 1;
            }
            100% {
            transform: translateY(0) translateX(0) scale(1);
            opacity: 0;
            z-index: 0; /* At the end, put the card back under the stack */
            }
        }
        .animated-card {
            animation: slideUpAndBack 1s forwards;
        }
        .card-stack {
            position: relative;
            height: 150px;
        }
        .card {
            width: 800px;
            height: 400px;
            margin: 0 auto;
            display: block;
            border: 3px solid black;
            border-radius: 15px;
            box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.4);
            padding: 30px;
            margin-top: 100px;
            background-color: #222;
            color: white;
            position: absolute;

            transition: transform 0.5s, opacity 0.5s;
        }
        .card + .card {
            margin-top: 10px;
            margin-left: 10px;
        }

        .card.passing {
            background-color: darkgreen;
            border-color: green;
        }

        .step-type {
            font-weight: bold;
            /* border-bottom: 3px solid black; */
            width: 150px;
            display: inline-block;
            border-right: 1px solid black;
            padding-right: 10px;
            text-align: right;
        }

        .givens,
        .whens,
        .thens {
            margin-top: 30px;
        }

        .given .step-type {
            color: lightskyblue;
        }

        .when .step-type {
            color: plum;
        }

        .then .step-type {
            color: peachpuff;
        }
    </style>
</head>

<body>
    <div id="app">
        <button @click="moveCard">Move Card</button>
        <card-stack>
            <transition-group name="card-animation" tag="div">
                <card class="card" 
                v-for="card in getCardsSorted" 
                :key="card.id"
                :class="{ 'animated-card': card.animate }">
                {{card.id}}
            </card>
            </transition-group>
        </card-stack>
    </div>

    <script>
        window.CardStack = {
            name: 'card-stack',
            template: `<div></div>`,
            computed: {
                
            }
        }
    </script>

    <script>
        window.CardComponent = {
                name: 'card',
                template: `
        <div>
          <p>{{ count }}</p>
          <button @click="increment">Increment</button>
        </div>
      `,
                computed: {
                    // Use mapGetters to create computed getters
                    ...Vuex.mapState([
                        'count'
                    ]),
                    
                },
                methods: {
                    // Use mapActions to map methods to store actions
                    ...Vuex.mapActions([
                        'increment'
                    ])
                }
            };
    </script>

    <script>
        function init_app(){
            // Create the Vue app
            const app = Vue.createApp({
                // This is the root instance definition
                components: {
                    'card': CardComponent,
                    'card-stack': CardStack
                },
                data(){
                    return {
                        cards: [
                            {},
                            {}
                        ]
                    }
                },
                methods: {
                    moveCard() {
                      this.$store.dispatch('moveCard');
                    },
                    animationEnd(card) {
                       this.$store.dispatch('animationEnd', card);
                    }
                },
                computed: {
                    ...Vuex.mapGetters([
                        'getCardsSorted'
                    ])
                }
                //store: store
            });

            // Use the store in the app
            app.use(store);

            // Mount the Vue app
            app.mount('#app');
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            init_store();
            init_app();
        });
        function init_store() {
            // Define a new Vuex store
            window.store = Vuex.createStore({
                state() {
                    return {
                        count: 0,
                        cardViewingOrder: [],
                        cardIDs: [],
                        cards: [
                            { id: 1, animate: false },
                            { id: 2, animate: false },
                            { id: 3, animate: false },
                        ]
                    };
                },
                mutations: {
                    increment(state) {
                        state.count++;
                    }
                },
                actions: {
                    increment(context) {
                        context.commit('increment');
                    }
                },
                getters: {
                    getCount(state) {
                        return state.count;
                    },
                    getCardsSorted(state){
                        return state.cardViewingOrder.map(id => state.cardIDs[id])
                    }
                }
            });


        }

        const f = new Feature("Watched Lots");
        window.state.features[f.name] = f;
        const s0 = new Scenario("Logged Out User attempts to watch a lot");
        s0.assignToFeature(f.name);
        s0.addStep(new Step("Given", "I am logged out"));
        s0.addStep(new Step("Given", "I am on the test presale lot 100 page"));
        s0.addStep(new Step("When", "I click on the unwatched heart to watch the lot"));
        s0.addStep(new Step("Then", "I am prompted to log in"));
    </script>
</body>

</html>